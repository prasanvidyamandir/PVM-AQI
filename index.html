<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PVM School AQI Monitoring</title>
    <script src="https://www.gstatic.com/firebasejs/9.1.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.1.0/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.1.0/firebase-auth-compat.js"></script>
    
    <style>
        :root {
            --bg: #0f172a; --card: #1e293b; --text: #f8fafc;
            --accent: #38bdf8; --good: #10b981; --mod: #f59e0b; --bad: #ef4444;
        }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 20px; text-align: center; }
        header { padding: 30px 0; border-bottom: 1px solid #334155; margin-bottom: 20px; }
        h1 { color: var(--accent); margin: 0; }
        
        .status-banner {
            max-width: 1000px; margin: 20px auto; padding: 25px;
            border-radius: 15px; font-size: 1.8rem; font-weight: bold;
            transition: 0.5s; background: #475569;
        }

        .grid {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px; max-width: 1000px; margin: 0 auto;
        }
        .card { background: var(--card); padding: 20px; border-radius: 12px; border: 1px solid #334155; }
        .label { font-size: 0.8rem; color: #94a3b8; text-transform: uppercase; }
        .value { font-size: 2rem; font-weight: bold; color: var(--accent); margin-top: 5px; }

        /* AQI Stage Colors */
        .GOOD { background: var(--good) !important; }
        .MODERATE { background: var(--mod) !important; }
        .BAD { background: var(--bad) !important; }

        .explanation {
            max-width: 1000px; margin: 40px auto; background: #1e1b4b;
            padding: 25px; border-radius: 15px; text-align: left;
        }
    </style>
</head>
<body>

    <header>
        <h1>PVM School AQI Monitoring</h1>
        <p>Live Classroom Air Quality Dashboard</p>
    </header>

    <div id="statusBox" class="status-banner">CONNECTING...</div>

    <div class="grid">
        <div class="card"><div class="label">Temperature</div><div id="temp" class="value">--</div></div>
        <div class="card"><div class="label">Humidity</div><div id="hum" class="value">--</div></div>
        <div class="card"><div class="label">CO2 Level</div><div id="co2" class="val">--</div></div>
        <div class="card"><div class="label">AQI Score</div><div id="aqiVal" class="value">--</div></div>
        <div class="card"><div class="label">Pressure</div><div id="pres" class="value">--</div></div>
        <div class="card"><div class="label">Voltage (Vo)</div><div id="vo" class="value">--</div></div>
    </div>

    <div class="explanation">
        <h2>ðŸ“Š What do these values mean?</h2>
        <ul>
            <li><strong>Temperature:</strong> Measures room warmth. Ideal for schools is 22-26Â°C.</li>
            <li><strong>Humidity:</strong> Moisture in the air. 40-60% is most comfortable for students.</li>
            <li><strong>CO2 Level:</strong> Carbon Dioxide concentration. High levels (>1500ppm) cause drowsiness.</li>
            <li><strong>Voltage (Vo):</strong> The raw electrical signal from the MQ135 sensor.</li>
            <li><strong>AQI Score:</strong> Overall safety rating from 0 (Perfect) to 500 (Hazardous).</li>
        </ul>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyCI997EpYisZVcH62mfo7RZRvnqp6PdE5M",
            authDomain: "pvm-aqi.firebaseapp.com",
            databaseURL: "https://pvm-aqi-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "pvm-aqi",
            storageBucket: "pvm-aqi.firebasestorage.app",
            messagingSenderId: "818530071670",
            appId: "1:818530071670:web:7400443c2dda040f025b57"
        };

        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.database();

        // --- UPDATE YOUR EMAIL AND PASSWORD HERE ---
        const userEmail = "pvmaqi@gmail.com"; 
        const userPass = "Pvmaqi@123";

        auth.signInWithEmailAndPassword(userEmail, userPass)
            .then(() => {
                console.log("Authenticated Successfully");
                // Start listening for data only after login
                db.ref('current').on('value', (snap) => {
                    const data = snap.val();
                    if (data) {
                        document.getElementById('temp').innerText = data.temp.toFixed(1) + "Â°C";
                        document.getElementById('hum').innerText = data.hum.toFixed(0) + "%";
                        document.getElementById('co2').innerText = data.co2.toFixed(0) + " PPM";
                        document.getElementById('aqiVal').innerText = data.aqiVal.toFixed(0);
                        document.getElementById('pres').innerText = data.pres.toFixed(0) + " hPa";
                        document.getElementById('vo').innerText = data.vo.toFixed(2) + "V";

                        const sBox = document.getElementById('statusBox');
                        sBox.innerText = "AQI STATUS: " + data.aqi;
                        sBox.className = "status-banner " + data.aqi;
                    }
                });
            })
            .catch((error) => {
                document.getElementById('statusBox').innerText = "AUTH ERROR: " + error.message;
                console.error(error);
            });
    </script>
</body>
</html>
